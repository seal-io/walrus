version: '3.6'

services:
  casdoor:
    image: "sealio/casdoor:v1.197.0-seal.3"
    restart: always
    privileged: true
    container_name: casdoor
    ports:
      # internal postgres db of casdoor(user/password: casdoor/casdoor),
      # expose for local debugging.
      #
      - "15432:5432"

  postgres:
    image: "postgres:14.6"
    restart: always
    privileged: true
    container_name: postgres
    ports:
      # external postgres db of seal(user/password: root:Root123),
      # expose for local debugging.
      #
      - "25432:5432"
    environment:
      # update the '--data-source-address' if change the following envs.
      #
      - POSTGRES_PASSWORD=Root123
      - POSTGRES_USER=root
      - POSTGRES_DB=seal

  redis:
    image: "redis:6.2.11"
    restart: always
    container_name: redis
    ports:
      # external redis db of seal(user/password: default:Default123),
      # expose for local debugging.
      #
      - "16379:6379"
    command:
      - redis-server
      - "--save"
      - "\"\""
      - "--appendonly"
      - "no"
      - "--databases"
      - "1"
      - "--requirepass"
      # update the '--cache-source-address' if change the following content.
      #
      - "Default123"

  seal:
    image: "sealio/seal-server:main"
    entrypoint: "/entrypoint.sh"
    restart: always
    # privileged is used for internal k3s.
    privileged: true
    container_name: seal
    environment:
      # avoid the impact from docker embedded DNS server.
      #
      - K3S_RESOLV_CONF=
    command:
      - "seal"
      - "--log-debug"
      - "--log-verbosity=4"
      - "--data-source-address=postgres://root:Root123@postgres:5432/seal?sslmode=disable"
      - "--cache-source-address=redis://default:Default123@redis:6379/0"
      - "--casdoor-server=http://casdoor:8000"
    depends_on:
      - casdoor
      - postgres
      - redis
    ports:
      - "80:80"
      - "443:443"
